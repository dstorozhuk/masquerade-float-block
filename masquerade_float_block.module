<?php

/**
 * @file masquerade_float_block.module
 * TODO: Enter file description here.
 */

/**
 * Implements hook_init().
 */
function masquerade_float_block_init() {
  $get = drupal_get_query_parameters();
  if (isset($get['mfb_show'])) {
    if (in_array($get['mfb_show'], array(1, 0))) {
      variable_set('masquerade_float_block_visible', $get['mfb_show']);
    }
    else {
      drupal_set_message(t('Incorrect mfb_show parameter value: only 1 or 0 possible.'));
    }
  }

  $masquerade_float_block_visible = variable_get('masquerade_float_block_visible', 1);

  if ($masquerade_float_block_visible) {
    $block = module_invoke('masquerade', 'block_view', 'masquerade');
    if (!empty($block)) {
      drupal_add_library('system', 'drupal.ajax');
      drupal_add_library('system', 'ui.dialog');
      drupal_add_library('system', 'effects');
      drupal_add_library('system', 'jquery.cookie');

      $block['content'] = drupal_render($block['content']);

      $data = array(
        'masquerade_float_block' => array('block' => $block)
      );
      drupal_add_js($data, 'setting');
      drupal_add_js(drupal_get_path('module', 'masquerade_float_block') . '/masquerade_float_block.js');
    }
  }
}


